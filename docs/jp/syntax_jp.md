# 文法ガイド

このセクションは JoSIM の中で利用可能な文法の包括的なガイドになります。

JoSIM は ***CaSe InSeNsItIvE*** であり、各行は読み込まれた際に大文字に変換されます。

付け加えると、いくつかの特定のケースでは値を解釈する際に混乱を生むことになるため、値に単位をつけるのは **推奨されません**。例えばキャパシタにファラド(F)を指定したとき、後ろに F がついている値はフェムト(f)に解釈されてしまうかもしれません。これは 5 ファラドのキャパシタが欲しくても 5 *フェムト* ファラドのキャパシタになってしまうということです。素子のタイプが単位を示すため、単位はシミュレータによって解釈されません。

## 基本的な文法

各行はノーブレークスペースを識別子として用いる似たような構文に則っています。各識別子は JoSIM に各行をどのように処理すればいいかを指定しています。

識別子は例えば L, C, R のような回路中の物理素子に関係する文字から始まっています。この類の行はほぼ常にラベルと 2 つのノードを必要とする同様の文法に則っています。ノードには英数字を使うことができます。ただし **0** と **GND** は接地されたノードであることを示します。また JoSIM の予約語であるため、ピリオド(**.**)またはパイプ(**|**)のラベルまたはノード名への使用は禁止されています。

ピリオド(**.**)で始まる行は、何らかのシミュレーションコントロールに関係していることを示しています。このような場合コマンドはコントロールを示すピリオドの後に続きます（.tran, .print, .end など）。

アスタリスク(**\***)もしくはシャープ(**\#**)で始まる行はコメントです。コメントは行全体に書く必要があり、行末に置かれた場合は機能しません。

行がプラス(**+**)から始まっている場合、その行は前の行からの続きであることを表しています。内部的には 2 つの行は結合されます。

多くの場合において素子の **VALUE** は変数名や式によって置き換え可能です。変数は **.PARAM** コントロールを用いて定義可能です。これについてはさらに詳しく議論されていきます。

JoSIM での値は工学的記数法または SI 接頭語を用いて調整することができます。使用可能な SI 接頭語のリストは以下の通りです：

| SI接頭語 | 意味 | 工学的記数法での値 |
| ------ | ------- | ------------------------------- |
| F      | Femto   | 1E-15                           |
| P      | Pico    | 1E-12                           |
| N      | Nano    | 1E-9                            |
| U      | Micro   | 1E-6                            |
| M      | Milli   | 1E-3                            |
| K      | Kilo    | 1E3                             |
| MEG    | Mega    | 1E6                             |
| X      | Mega    | 1E6                             |
| G      | Giga    | 1E9                             |
| T      | Tera    | 1E12                            |

## 基本素子

ここからは全ての使用可能な物理素子と制限について見ていきます。角括弧の中のパラメータは任意のものであり、ネストされた角括弧はその前のものがあることに依存した、カプセル化されたパラメータを意味しています。

### 抵抗 {#resistor}

**R**Label&emsp;$N^{+}$&emsp;$N^{-}$&emsp;**VALUE**&emsp;[temp=<**TEMP**>]&emsp;[neb=<**FREQ**>]

抵抗の値はオームです。

温度はノイズ解析に使用され、単位はケルビンです。JoSIM ではケルビンとして **K** を使おうとしてもキロとして解釈されるため、単位は除外しておく必要があります。（例：4K は 4000 になります。）

任意の周波数パラメータはノイズ解析における雑音の有効帯域幅を設定します。デフォルトは 1GHz です。

### インダクタ {#inductor}

**L**Label&emsp;$N^{+}$&emsp;$N^{-}$&emsp;**VALUE**

インダクタの値はヘンリーで表されます。

### キャパシタ {#capacitor}

**C**Label&emsp;$N^{+}$&emsp;$N^{-}$&emsp;**VALUE**

キャパシタの値はファラドで表されます。

### Josephson Junction (JJ) {#josephson-junction-jj}

**B**Label&emsp;$N^{+}$&emsp;$N^{-}$&emsp;*<PhaseNode\>*&emsp;**MODEL**&emsp;[area=<**AREA**\>]&emsp;[ic=<**IC**>]&emsp;[temp=<**TEMP**>]&emsp;[neb=<**FREQ**>]

ジョセフソン接合は二端子デバイスですが、WRspice との互換性のため三番目の接続されていないノードと共に定義することも可能です。このノードは JoSIM では使用されません。

ジョセフソン接合には、**.MODEL** コントロールを用いてプログラムのどこにでも定義することができるモデル名の詳細が必要です。

**AREA** または **IC** が指定されていない場合 area=1 がデフォルトで使用されます。

temp と neb コマンドの説明は抵抗と同じです。

#### モデル

モデルコントロールは次のような文法を持ちます。

**.MODEL**&emsp;*ModelName*&emsp;*ModelType*([**MODEL PARAMETERS**])

JoSIM で現在サポートしている接合モデルは RCSJ モデルだけであるため、唯一使用可能なモデルタイプは次のようにパラメータが設定可能な **jj** だけです：

| パラメータ       | 範囲               | デフォルト         | 説明                                                  |
| --------------- | ------------------- | --------------- | ------------------------------------------------------------ |
| RTYPE           | 0, 1                | 1               | 線型化モデルが使われている                                     |
| VG or VGAP      | -$\infty$, $\infty$ | 2.8E-3          | 超電導ギャップ電圧                                         |
| IC or ICRIT     | -$\infty$, $\infty$ | 1E-3            | 超電導臨界電流値                                    |
| RN              | 0, $\infty$         | 5               | 接合抵抗                                   |
| R0              | 0, $\infty$         | 30              | サブギャップ抵抗                                   |
| C or CAP        | 0, $\infty$         | 2.5E-12         | 接合容量                                         |
| T               | 0, $\infty$         | 4.2             | 接合部温度 (K)                     |
| TC              | 0, $\infty$         | 9.1             | 超電導素材の臨界温度             |
| DELV            | 0, $\infty$         | 0.1E-3          | サブギャップから常伝導状態への転移電圧                   |
| D               | 0.0, 1              | 0.0             | 電流位相関係に影響する接点の透過率 |
| ICFCT or ICFACT | 0, 1                | $\frac{\pi}{4}$ | 臨界電流の準粒子ステップ高さに対する比       |
| PHI             | 0, $2\pi$           | 0               | $\pi$-junction のような phi-junction を実現可能にする   |
| CPR             | {$-\infty$, $\infty$) | {1}           | 現在の位相関係の高調波振幅を設定します。 |

*.model* の行はサブサーキット固有であるため、同じ名前の異なるモデルを分離されたサブサーキット下にそれぞれ置くことができます。サブサーキット下にモデルが見つからなかった場合グローバルなものを探すことになり、それでも見つからない場合はデフォルトの値（デフォルトのモデル）が使用されます。

**AREA** と **IC** パラメータはモデルパラメータの修飾子としてはたらきます。**IC** が指定されると **AREA** の値は $AREA=\frac{IC_{jj}}{IC_{model}}$ によって置き換えられる、臨界電流でかけられた値となります。

モデルの **PHI** パラメータを設定することで、JJ 電流の $\sin(\phi)$ 部分の中にある位相($\phi$)から常に引いたものが位相の値になります。これによって $\pi$-junction のような素子をモデル化可能です。

CPR パラメータは、ジャンクション超電流の個々の高調波を変更します。単一の値、または中括弧でカプセル化された n 個の値の配列のいずれかです。つまり、*CPR={0.9, 0.1}* は、現在の位相関係を次の $I = I_C(0.9\sin(\phi) + 0.1\sin(2\phi))$ に設定します。[^1][^2]

### Transmission Line {#transmission-line}

**T**Label&emsp;$N^{+}_{1}$&emsp;$N^{-}_{1}$&emsp;$N^{+}_{2}$&emsp;$N^{-}_{2}$&emsp;**TD=VALUE**&emsp;**Z0=VALUE**

**TD** は単位時間あたりの遅延時間です。

**Z0** はオームで表したインピーダンスです。

### 相互インダクタンス {#mutual-inductance}

**K**Label&emsp;$L_{1}$&emsp;$L_{2}$&emsp;**VALUE**

値は結合係数 *k* です。

## Sources

### Independent Sources

#### 電圧源 {#voltage-source}

**V**Label&emsp;$N^{+}$&emsp;$N^{-}$&emsp;**SOURCETYPE**

#### 電流源 {#current-source}

**I**Label&emsp;$N^{+}$&emsp;$N^{-}$&emsp;**SOURCETYPE**

#### 位相源 {#phase-source}

**P**Label&emsp;$N^{+}$&emsp;$N^{-}$&emsp;**SOURCETYPE**

### Dependent Sources

#### 電流制御電流源 {#current-controlled-current-source}

**F**Label&emsp;$N^{+}$&emsp;$N^{-}$&emsp;$N^{+}$Control&emsp;$N^{-}$Control&emsp;**CURRENT GAIN**

#### 電流制御電圧源 {#current-controlled-voltage-source}

**H**Label&emsp;$N^{+}$&emsp;$N^{-}$&emsp;$N^{+}$Control&emsp;$N^{-}$Control&emsp;**TRANSRESISTANCE IN OHMS**

#### 電圧制御電流源 {#voltage-controlled-current-source}

**G**Label&emsp;$N^{+}$&emsp;$N^{-}$&emsp;$N^{+}$Control&emsp;$N^{-}$Control&emsp;**TRANSCONDUCTANCE IN MHOS**

#### 電圧制御電圧源 {#voltage-controlled-voltage-source}

**E**Label&emsp;$N^{+}$&emsp;$N^{-}$&emsp;$N^{+}$Control&emsp;$N^{-}$Control&emsp;**VOLTAGE GAIN**

### Source Types

#### 区分線形 (PWL)

**pwl(0**&emsp;**0**&emsp;$T_{1}$&emsp;$A_{1}$&emsp;...&emsp;$T_{n}$&emsp;$A_{n}$**)**

このソースは指定された振幅間で、シミュレーション中の各時間において線形に振幅を補間します。

最初の 2 つの値はシミュレーションのはじめに 0 にしておく必要があります。

#### パルス

**pulse(**$A_{1}$&emsp;$A_{2}$&emsp;[$T_{D}$&emsp;[$T_{R}$&emsp;[$T_{F}$&emsp;[*PW*&emsp;[*PER*]]]]] **)**

このソースは二つの振幅($A_{1}$ と $A_{2}$)にわたり、$T_{D}$ 後に始まって rise・fall タイム($T_{R}$ と $T_{F}$)を持つパルスを生成します。rise・fall タイムのデフォルトはトランジェントシミュレーションのステップサイズです。

*PW* と *PER* はそれぞれパルス幅と周期を参照しています。この値は指定されていないときデフォルトではトランジェントシミュレーションの停止時間となります。

このソースでは周波数を設定したとき継続的にパルスを発生させられるようになります。

#### サイン波

**sin(**$A_{O}$&emsp;$A$&emsp;[$f$&emsp;[$T_{D}$&emsp;[$\theta$&emsp;[$\phi$&emsp;[$N_{C}$]]]]] **)**

$A_{O}$ をオフセット、$A$ を振幅、$f$ を周波数（Hz）とする（任意で減衰する）サイン波信号を生成するソースです。$f$ が省略された場合、デフォルトは $\frac{1}{T_{STOP}}$ です。

$T_{D}$ は開始遅延です。$t<T_{D}$ の間、出力は $A_{O}$ に保持されます。

$\theta$ は指数減衰係数（単位 $s^{-1}$）です。$\theta=0$ のとき減衰はありません。

$\phi$ はサイン項に加算される位相シフトです。内部的にはラジアンとして扱われますが、度で指定された場合は $\phi=\phi_{\deg}\pi/180$ により変換されます。

$N_{C}$ が指定され、かつ $N_{C}>0$ の場合、サイン波は指定サイクル数だけ出力された後に停止し、それ以降はオフセット $A_{O}$ に戻って保持されます。

この関数は次の区分的定義に基づきトランジェント解析中の各ステップにおいてデータ点を生成します（$\tau=t-T_{D}$ とする）：

$$
f(t)=
\begin{cases}
A_{O}, & t < T_{D}\\[4pt]
A_{O} + A\,e^{-\theta \tau}\,\sin\!\big(2\pi f\,\tau + \phi\big), &
T_{D} \le t < T_{D}+\dfrac{\text{$N_{C}$}}{f}\quad(\text{$N_{C}$}>0 のとき)\\[10pt]
A_{O}, & t \ge T_{D}+\dfrac{\text{$N_{C}$}}{f}\quad(\text{$N_{C}$}>0 のとき)\\[6pt]
A_{O} + A\,e^{-\theta \tau}\,\sin\!\big(2\pi f\,\tau + \phi\big), &
t \ge T_{D}\quad(\text{$N_{C}$}\le 0 または省略のとき)
\end{cases}
$$

注意：

- $N_{C}$ が省略（または $\le 0$）の場合、サイン波はシミュレーション終了まで継続します。
- $N_{C}>0$ の場合、停止時刻を定義するために $f$ は正である必要があります。

#### カスタム波形

**cus(** *wavefile*&emsp;$T_{S}$&emsp;*SF*&emsp;*IM*&emsp;[$T_{D}$&emsp;*PER]* **)**

このソースはテキストの波形ファイルの中の点に基づいて関数を生成することが出来ます。このファイルは一行でスペース区切りの数値が入っていなければなりません。（例：0 2 3 6 2 1 0）

行中の各数値はタイムステップ $T_{S}$ で分けられた振幅を表しており、スケールファクター *SF* によって拡大縮小されています。点と点の間の値は補間なし(0)、線形補間(1)、またはキュービック補間(2)のいずれかを用いて補間されます。関数は PER が 1 にセットされていると周期的にすることができ、ここでパターンはシミュレーション全体にわたって繰り返されます。

波形は $T_{D}$ から始まります。

#### DC

*dc*&emsp;$A$

DC ソースはシミュレーションの間いつでも $A$ となります。

#### ノイズ

**noise(**$A$&emsp;$T_{D}$&emsp;$T_{STEP}$**)**

このソースは $T_{D}$ の後のタイムステップに対しノイズ値を生み出します。$T_{STEP}$ は、`.neb` を使うことでグローバルに、または `neb=` を用いて抵抗に対しローカルに設定される、ノイズの有効帯域幅の逆数です。

返されるノイズ値は次の式を用いて計算されます：

$f(t) = A\frac{GRAND()}{\sqrt{2T_{STEP}}}$

$GRAND()$ はガウシアン乱数生成関数です。

#### 指数関数

**exp(** $A_{1}$&emsp;$A_{2}$&emsp;$T_{D1}$&emsp;$\tau_{1}$&emsp;$T_{D2}$&emsp;$\tau_{2}$**)**


| Parameter  | Default           |
| ---------- | ----------------- |
| $T_{D1}$   | 0.0               |
| $T_{D2}$   | $T_{STEP}$        |
| $\tau_{1}$ | $T_{D1}+T_{STEP}$ |
| $\tau_{2}$ | $T_{STEP}$        |


3 つの異なる時間区分で異なる値を返します。

$t < T_{D1}$ において：

$f(t)=A_{1}$

$T_{D1}\le t < T_{D2}$ において：

$f(t) = A_{1}+(A_{2}-A_{1})(1-e^{\frac{t - T_{D1}}{\tau_{1}}})$

$T_{D2} \le t$ において：

$f(t) = A_{1}+(A_{2}-A_{1})(1-e^{\frac{t - T_{D1}}{\tau_{1}}})+(A_{1}-A_{2})(1-e^{\frac{t - T_{D2}}{\tau_{2}}})$

#### 区分サイン補間 (PWS)

**pws(**$T_{0}$&emsp;$V_{0}$&emsp;$T_{1}$&emsp;$V_{1}$&emsp;...&emsp;$T_{N}$&emsp;$V_{N}$ **)**

このソースは、ユーザが指定した複数の時刻/値の点を滑らかに通過する波形を生成します。**pwl(...)** と同様に点列を与えますが、点と点の間を線形補間する代わりに、サイン（半コサイン）型のスプラインで補間します。

各点は時間と値のペア \((T_i, V_i)\) として指定します。時間 \(T_i\) は **必ず単調増加（厳密に増加）** でなければなりません。

- \(t < T_0\) のとき、出力は \(V_0\) に保持されます。
- \(t \ge T_N\) のとき、出力は \(V_N\) に保持されます。
- \(T_i \le t < T_{i+1}\) のとき、出力は \(V_i\) から \(V_{i+1}\) へ半コサイン（サインイージング）で滑らかに遷移します。

区間 \(i\) について \(u=\dfrac{t-T_i}{T_{i+1}-T_i}\)（\(0 \le u < 1\)）とすると、出力は次式で与えられます：

$$
f(t)=V_i + (V_{i+1}-V_i)\,\frac{1-\cos(\pi u)}{2},
\qquad T_i \le t < T_{i+1}
$$

この補間は連続であり、指定点 \(T_i\) での傾きが 0 になるため、ブレークポイント間の接続が滑らかになります。

注意：

- 最終時刻 \(T_N\) の後は、値 \(V_N\) が一定として保持されます。
- 同一時刻の重複や時間が増加しない点列は無効であり、エラーになる可能性があります。

## コントロールコマンド

（以下、既存の日本語ページの内容をそのまま続けてください）

[^1]:I. Salameh, E. G. Friedman and S. Kvatinsky, "Superconductive Logic Using 2ϕ—Josephson Junctions With Half Flux Quantum Pulses," in *IEEE Transactions on Circuits and Systems II: Express Briefs*, vol. 69, no. 5, pp. 2533-2537, May 2022, doi: 10.1109/TCSII.2022.3162723.
[^2]:S. V. Bakurskiy et al., "Current-phase relations in SIsFS junctions in the vicinity of 0-$\pi$ Transition", *Phys. Rev. B Condens. Matter*, vol. 95, pp. 94522-94528, Mar. 2017.
