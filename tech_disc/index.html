


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Johannes Delport">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.4.0">
    
    
      
        <title>Technical Discussion - JoSIM v2.4 Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.fe0cca5b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#technical-discussion" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="JoSIM v2.4 Documentation" class="md-header-nav__button md-logo" aria-label="JoSIM v2.4 Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            JoSIM v2.4 Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Technical Discussion
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/JoeyDelp/JoSIM/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="JoSIM v2.4 Documentation" class="md-nav__button md-logo" aria-label="JoSIM v2.4 Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    JoSIM v2.4 Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/JoeyDelp/JoSIM/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Technical Discussion
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Technical Discussion" class="md-nav__link md-nav__link--active">
      Technical Discussion
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modified-nodal-analysis" class="md-nav__link">
    Modified nodal analysis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trapezoidal-integration" class="md-nav__link">
    Trapezoidal integration.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gear-integration" class="md-nav__link">
    Gear Integration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modified-nodal-phase-analysis" class="md-nav__link">
    Modified nodal phase analysis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lu-decomposition" class="md-nav__link">
    LU decomposition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-structures-speed-considerations" class="md-nav__link">
    Data structures &amp; speed considerations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input-files" class="md-nav__link">
    Input Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-files" class="md-nav__link">
    Output Files
  </a>
  
    <nav class="md-nav" aria-label="Output Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#plotting-interfaces" class="md-nav__link">
    Plotting interfaces
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ex_usage/" title="Example Usage" class="md-nav__link">
      Example Usage
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../comp_stamps/" title="Component Stamps" class="md-nav__link">
      Component Stamps
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../syntax/" title="Syntax Guide" class="md-nav__link">
      Syntax Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../bugs/" title="Development Schedule and Bugs" class="md-nav__link">
      Development Schedule and Bugs
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modified-nodal-analysis" class="md-nav__link">
    Modified nodal analysis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trapezoidal-integration" class="md-nav__link">
    Trapezoidal integration.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gear-integration" class="md-nav__link">
    Gear Integration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modified-nodal-phase-analysis" class="md-nav__link">
    Modified nodal phase analysis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lu-decomposition" class="md-nav__link">
    LU decomposition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-structures-speed-considerations" class="md-nav__link">
    Data structures &amp; speed considerations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input-files" class="md-nav__link">
    Input Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-files" class="md-nav__link">
    Output Files
  </a>
  
    <nav class="md-nav" aria-label="Output Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#plotting-interfaces" class="md-nav__link">
    Plotting interfaces
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/JoeyDelp/JoSIM/edit/master/docs/tech_disc.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="technical-discussion">Technical Discussion</h1>
<h2 id="modified-nodal-analysis">Modified nodal analysis</h2>
<p>There are many ways to setup a set of linear equations to solve the voltage or currents in a circuit. One of the more well known ways is to use nodal analysis which creates an equation for each node defined in the circuit netlist. This method is the basis on which the original Berkeley SPICE[<a class="citation" href="#ref-spice" id="cite-spice">spice</a>] was built. This method, however, only calculates the voltages of every node which makes it difficult to handle components that are voltage dependent such as inductors and junctions.</p>
<p>This drawback lead to the creation of the modified nodal analysis which is an extension to the prior with the ability to calculating branch currents in addition to nodal voltages[<a class="citation" href="#ref-mna" id="cite-mna">mna</a>]. We therefore make use of the MNA method to build the set of linear equations within JoSIM due to the large use of inductors as well as Josephson junctions in superconductivity.</p>
<p>A useful feature of the MNA method allows every component to be represented as a sub-matrix called a stamp. The summation of all the stamps provide us with the <strong>A</strong>, <strong>x</strong> as well as <strong>b</strong> matrices that are required to solve the linear equations. These stamps will be discussed further in the following subsection.</p>
<h2 id="trapezoidal-integration">Trapezoidal integration.</h2>
<p>The trapezoidal method for solving linear equations is a second order method for which the solution accuracy improves by reducing the time step size.</p>
<p>We can express the trapezoidal method as:</p>
<p>
<script type="math/tex; mode=display">\left( \frac{dx}{dt}\right) _{n}=\frac{2}{h_{n}}\left( x_{n} - x_{n-1} \right) - \left(\frac{dx}{dt} \right) _{n-1} </script>
</p>
<p>In this case <script type="math/tex">n</script> is the current time step and <script type="math/tex">n-1​</script> refers to the previous time step. By using this method to solve differential equations we are able to create generic stamps for each component that JoSIM can handle.</p>
<p>To demonstrate this method and how a stamp is formed we will show an example of an inductor.
<figure>
    <img src="../img/inductor.pdf" alt="Inductor Symbol" class="center" width="25%">
    <figcaption align="center">Fig. 1 - A basic inductor with current flowing through it</figcaption>
</figure></p>
<p>The inductor in Fig. 1 has a general equation to determine the voltage across it as:</p>
<p>
<script type="math/tex; mode=display"> v_{L1}(t) = L1\frac{di}{dt} </script>
</p>
<p>When we apply the trapezoidal rule we find that this equation can be rewritten as:</p>
<p>
<script type="math/tex; mode=display">\begin{align}
    v_{n} &= L1 \left[ \frac{2}{h_n} \left( I_{n} - I_{n-1} \right) - \left( \frac{di}{dt}\right)_{n-1} \right] \\
    & = \frac{2L1}{h_n} \left( I_{n} - I_{n-1} \right) - L1 \left( \frac{di}{dt}\right)_{n-1} \\
    & = \frac{2L1}{h_n} \left( I_{n} - I_{n-1} \right) - v_{n-1} \\
    \therefore I_{n} & = \frac{h_{n}}{2L1} \left( V_{n} + V_{n-1}\right) + I_{n-1} \\
    \therefore \frac{h_{n}}{2L1}V_{n} - I_{n} & = -\frac{h_{n}}{2L1}V_{n-1} + I_{n-1}
\end{align}</script>
</p>
<p>Where the above is the current step voltage and current as a function of the previous step values. We further expand this equation by stating that the voltage is the potential across the two nodes: <script type="math/tex">v = v_{1} - v_{2} </script>.</p>
<p>
<script type="math/tex; mode=display">\begin{equation}
    \frac{h_{n}}{2L1}(V_{1})_{n} - \frac{h_{n}}{2L1}(V_{2})_{n} - I_{n} = -\left( \frac{h_{n}}{2L1}V(V_{1})_{n-1} - \frac{h_{n}}{2L1}(V_{2})_{n-1}\right)  - I_{n-1}
\end{equation}</script>
</p>
<p>Which we can then write in matrix form as:</p>
<p>
<script type="math/tex; mode=display">\begin{equation}
    \begin{bmatrix}
        0 & 0 & 1 \\
        0 & 0 & -1 \\
        1 & -1 & \frac{-2L1}{h_n}
    \end{bmatrix}
    \begin{bmatrix}
        V_{1} \\
        V_{2} \\
        I_{L1}
    \end{bmatrix}
    =
    \begin{bmatrix}
        0 \\
        0 \\
        -\frac{2L1}{h_{n}}(I_{L1})_{n-1} - \left( (V_{1})_{n-1} - (V_{2})_{n-1}\right)
    \end{bmatrix}
\end{equation}</script>
</p>
<p>The matrix above is a generic stamp that we can place into the A matrix which describes the inductor L1.</p>
<p>We can do the same for a resistor, capacitor, current source, voltage source, Josephson junction and a transmission line. The stamps for each of these components can be found in the <a href="../comp_stamps/">Component Stamps</a> section.</p>
<h2 id="gear-integration">Gear Integration</h2>
<p>Similar to the trapezoidal method, the Gear method or BDF2 (backward differentiation formulae) is also a second order integration method. This method, however, is better known as a linear multistep method and is the most stable second order integration method. </p>
<p>This method is expressed as:
<script type="math/tex; mode=display">
\left(\frac{dx}{dt}\right)_n = \frac{3}{2h}\left[x_n - \frac{4}{3}x_{n-1} + \frac{1}{3}x_{n−2}\right]
</script>
This method requires knowledge of at least 2 prior timesteps, indicated by <script type="math/tex">n-1</script> and <script type="math/tex">n-2</script>. Though this method might seem like it requires extra computation for every component, it actually simplifies components that require differentials.</p>
<p>We demonstrate this using the capacitor.</p>
<figure>
    <img src="../img/capacitor.pdf" alt="Capacitor Symbol" class="center" width="25%">
    <figcaption align="center">Fig. 2 - A basic capacitor with current flowing through it</figcaption>
</figure>

<p>The capactor in Fig. 2 has a general equation to determine the current through it as:</p>
<p>
<script type="math/tex; mode=display"> i_{C1}(t) = C1\frac{dv}{dt} </script>
</p>
<p>When we apply the Gear method to find that this equation can be rewritten as:</p>
<p>
<script type="math/tex; mode=display">\begin{align}
    i_{n} &= C1 \frac{3}{2h} \left[ v_n -\frac{4}{3}v_{n-1}+\frac{1}{3}v_{n-2}\right] \\
    & = \frac{3C1}{2h} V_n - \frac{2C1}{h}V_{n-1}+\frac{C1}{2h}V_{n-2}\  \\
    \therefore \frac{3C1}{2h} V_n - I_{n} & =  \frac{2C1}{h}V_{n-1}-\frac{C1}{2h}V_{n-2}
\end{align}</script>
</p>
<p>or rather
<script type="math/tex; mode=display">
V_n - \frac{2h}{3C1}I_n = \frac{4}{3}V_{n-1}-\frac{1}{3}V_{n-2}
</script>
Which we can then write in matrix form as:</p>
<p>
<script type="math/tex; mode=display">\begin{equation}
    \begin{bmatrix}
        0 & 0 & 1 \\
        0 & 0 & -1 \\
        1 & -1 & - \frac{2h}{3C1}
    \end{bmatrix}
    \begin{bmatrix}
        V_{1} \\
        V_{2} \\
        I_{C1}
    \end{bmatrix}
    =
    \begin{bmatrix}
        0 \\
        0 \\
        \frac{4}{3}V_{n-1}-\frac{1}{3}V_{n-2}
    \end{bmatrix}
\end{equation}</script>
</p>
<p>The matrix above is a generic stamp that we can place into the A matrix which describes the capacitor C1.</p>
<p>The extension that will allow JoSIM to use Gear method is available in v2.5 (testing) at time of writing.</p>
<h2 id="modified-nodal-phase-analysis">Modified nodal phase analysis</h2>
<p>First introduced in version 2.0 of JoSIM, the ability to perform a simulation that calculates the nodal phase instead of voltage is presented. This new analysis method is named the modified nodal phase analysis (MNPA) and utilizes the voltage-phase [<a class="citation" href="#ref-orlando" id="cite-orlando">orlando</a>] relationship seen below.</p>
<p>
<script type="math/tex; mode=display">\begin{equation}
    v = \frac{\Phi_{0}}{2\pi}\frac{d\phi}{dt}
\end{equation}</script>
</p>
<p>If this relationship is applied to all the component models found in JoSIM we obtain the MNPA stamps, which allow us to solve the phase directly. As example we demonstrate this on the inductor equation shown in the previous section.</p>
<p>
<script type="math/tex; mode=display">\begin{align}
    \frac{\Phi_{0}}{2\pi}\frac{d\phi}{dt} &= L1\frac{di}{dt} \\ 
    \frac{\Phi_{0}}{2\pi}\phi_{n} &= L1 I_{n} \\
    \frac{\Phi_{0}}{2\pi L1}\phi_{n}^{+} -  \frac{\Phi_{0}}{2\pi L1}\phi_{n}^{-}&= I_{n}
\end{align}</script>
</p>
<p>The above is functionally equivalent to the resistor in voltage analysis. The computation required to solve the phase of an inductor is therefore far less complex than that of solving the voltage. With superconducting circuits being largely inductive, the use of phase reduces the overall complexity of the solution which in turn provides faster simulations and reduced memory usage.</p>
<p>JoSIM has been adapted to allow phase analysis on any design that works with voltage analysis without requiring alterations to the netlist file. Since the voltage is simply the scaled time derivative of the phase the voltage can be calculated as a post process if the user requests it.</p>
<p>Phase mode simulation can be enabled using the command line switch <strong>-a</strong> followed by a <strong>1</strong>. If not provided the default for this command is <strong>0</strong>, which indicates a voltage mode simulation will be performed.</p>
<p>All the MNPA stamps are included in the <a href="../comp_stamps/">Component Stamps</a> section.</p>
<h2 id="lu-decomposition">LU decomposition</h2>
<p>When the A matrix has been set up as detailed in the previous section all that is left to do is to solve the <script type="math/tex">Ax=b​</script> problem using some form of iterative method. We choose KLU from the SuiteSparse[<a class="citation" href="#ref-suitesparse" id="cite-suitesparse">suitesparse</a>] library to accomplish this task.</p>
<p>This requires the A matrix to be in compressed row storage (CRS)[<a class="citation" href="#ref-crs" id="cite-crs">crs</a>] format which is a data structure of 3 vectors. The first of these vectors contains all the non-zero elements in the A matrix. The second contains an initial zero followed by the total number of non-zero elements at the end of each row such that the final entry in the vector is the total number of non-zero elements. The third vector contains the column index of each non-zero element. As an example, the following sparse <script type="math/tex">5x5</script> matrix:</p>
<p>
<script type="math/tex; mode=display">\begin{equation}
    \begin{bmatrix}
        1 & 0 & 0 & 4 & 0\\
        0 & 3 & 2 & 0 & 0 \\
        0 & 0 & 1 & 0  & 0\\
        0& 4 & 0 & 5 & 0 \\
        0 & 0 & 0 & 0 & 1
    \end{bmatrix}
\end{equation}</script>
</p>
<p>would yield a CSR format data structure of </p>
<p>
<script type="math/tex; mode=display">\begin{align}
    nnz & = \left[ 1, 4, 3, 2, 1, 4, 5, 1 \right]  \\
    rowptr & = \left[ 0, 2, 4, 5, 7, 8 \right] \\
    colind & = \left[ 0, 3, 1, 2, 2, 1, 3, 4 \right]
\end{align}</script>
</p>
<p>which has a total of 21 elements compared to the 25 required for the original A matrix. This difference, ofcourse, becomes much greater as the A matrix grows in size as well as the sparser the matrix becomes, which is almost always the case for electrical type simulations.</p>
<p>Once in this format we can proceed with the KLU factorization. Due to the MNA forcing only the RHS to change upon every time step, we only have to compute the LU decomposition for the A matrix once at the start of the time loop. With this single calculation of the LU decomposition done, the only calculation required is the solving of <script type="math/tex">x</script> (LHS) upon each iteration using the ever changing <script type="math/tex">b</script> (RHS).</p>
<h2 id="data-structures-speed-considerations">Data structures &amp; speed considerations</h2>
<p>JoSIM relies heavily on the use of the C++ map data structure which creates a hash table for quick lookup. This immensely simplifies code legibility as well as component identification within later stages of the process. The drawback of this, however, is the hashing and comparing becomes quite slow when using string types. </p>
<p>Initially a standard map was used, however, this very negatively impacted the execution speed of the program and thus alternatives were sought. These ordered map (standard maps) were replaced by the much faster unordered map since the map no longer needed to be sorted by keys upon each new entry. Ideally the use of unordered maps are not perfect if speed was the only consideration. They do, however, provide a good balance between implementation, speed and debugging.</p>
<p>To avoid some of the speed problems, a string map is only used initially to create components, mapping component labels to integer indices. During the simulation step only the indices are used. The results are then mapped back to the string equivalents to find the relevant output vectors requested by the user.</p>
<p>Additional steps have been implemented to reduce the required memory for the result vectors. This is achieved by idenitifying which vectors are required to produce the relevant output prior to simulation. During simulation only these required vectors are then populated with values as opposed to storing all calculated values. This drastically reduces the required memory.</p>
<p>Through the implementation of the MNPA method in JoSIM, additional improvements were introduced such as the objectification of every component at the matrix creation level that increases efficiency and debugging. This change allows for simplification of output functions since a direct link to the rows of the result matrix for each component reduces the indexing time required to identify the correct row. </p>
<h2 id="input-files">Input Files</h2>
<p>Input files for JoSIM are called netlists and follow mostly a standard SPICE syntax as described in [<a class="citation" href="#ref-spice" id="cite-spice">spice</a>]. There are, however, many functions and components of this syntax that have not been implemented since they are only of relevance to semiconductor circuits. A full syntax guideline is avalable in the <a href="../syntax/">Syntax</a> section.</p>
<p>There are a few caviates to making JoSIM compatible with other netlist generating systems. Most of these can be ironed out through routines within the code itself to make the simulator as accepting as possible. One of these caviates, however, requires user input and this is to identify the convention used when simulating using subcircuits.</p>
<p>When a netlist with subcircuits is generated to be JSIM[<a class="citation" href="#ref-jsim" id="cite-jsim">jsim</a>] compatible, a subcircuit line would for example be:</p>
<p>X01&nbsp;&nbsp;&nbsp;&nbsp;SUBNAME&nbsp;&nbsp;&nbsp;&nbsp;    1&nbsp;&nbsp;&nbsp;&nbsp;   2</p>
<p>This indicates that a subcircuit of name SUBNAME is to be used with I/O nodes 1 and 2. This we call convention <strong>0</strong> and is the default for JoSIM.</p>
<p>If a circuit is generated for compatibility with WRspice[<a class="citation" href="#ref-wrspice" id="cite-wrspice">wrspice</a>] then this convention would be <strong>1</strong> and an example of a subcircuit line would be:</p>
<p>X01&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;SUBNAME</p>
<p>This is the general SPICE syntax convention and in all honesty makes more sense since a component definition line should always carry the notation:</p>
<p>LABEL&nbsp;&nbsp;&nbsp;&nbsp;POSNODE&nbsp;&nbsp;&nbsp;&nbsp;NEGNODE</p>
<p>It is required that the user specify the convention when working with a non JSIM netlist. The convention can be set using the <strong>-c</strong> command line switch followed by the convention required.</p>
<h2 id="output-files">Output Files</h2>
<p>As stated before, JoSIM is a simulator that solves <script type="math/tex">Ax=b</script> problems. As a result the output that JoSIM provides to the user is always that of the <script type="math/tex">x</script> vector. At present JoSIM only does a transient analysis, which means that each entry of the <script type="math/tex">x</script> vector contains another vector of result values for each time step in the transient analysis.</p>
<p>When the user does not request any output, and does not specify a file within which to save the results, all of the results for the entire <script type="math/tex">x</script> vector are dumped to the screen in a space seperated way. This can be resource intensive and does not mean much to the user. It is therefore advisable to always specify the vectors of interest using the output commands specfied in <a href="../syntax/">Syntax</a> as well as a resulting file to store the output in. </p>
<p>The output file can be either a <em>comma seperated variable</em> (<em>.csv</em>) file or a <em>space seperated</em> (<em>.dat</em>) file. The the type and name of the output file are specified using the <strong>-o</strong> command switch followed by the file name. The file extension determines the type. </p>
<p>There is a third option of output format which follows the standard SPICE RAW data syntax. This format is compatible with various output trace viewers and can be specified by simply ommiting the file extension of in the output name.</p>
<h3 id="plotting-interfaces">Plotting interfaces</h3>
<p>In previous versions of JoSIM there existed 2 plotting windows, namely FLTK and Matplotlib. These interfaces were, however, ultimately scrapped due to maintainability issues as well as cross-platform compatibility. The user is requested to use the plotting system they are most comfortable with. </p>
<p>Below we provide a simple Python 3 script that plots all the results in a <em>.csv</em> file. It is very basic and the user should modify it as required. This script requires installation of the <strong>Numpy</strong> as well as <strong>Matplotlib</strong> packages for Python 3. Optionally, we comment the lines for use of the <strong>Qt5</strong> backend for plotting. The user can enable this if the <strong>PyQt5</strong> package is installed.</p>
<pre><code class="python">#!/usr/bin/env python
import math
# import matplotlib
# matplotlib.use('Qt5Agg')
import matplotlib.pyplot as pl
from matplotlib import gridspec
import numpy as np
import csv
import sys

time = []
data = []
labels = set()
with open(sys.argv[1], 'r') as csvFile:
    reader = csv.DictReader(csvFile)
    labels = reader.fieldnames
    data.append([])
    for row in reader:
        time.append(float(row[labels[0]]))
        for var in range(1,len(labels)):
            data.append([])
            data[var].append(float(row[labels[var]]))
csvFile.close()

N = len(labels) - 1
cols = int(math.ceil(N / 4))
rows = int(math.ceil(N / cols))

gs = gridspec.GridSpec(rows, cols)
fig = pl.figure()
for var in range(1,len(labels)):
    ax = fig.add_subplot(gs[var - 1])
    ax.plot(time, data[var])
    ax.set_xlabel(labels[0])
    ax.set_ylabel(labels[var])

fig.set_tight_layout(True)
fig.show()
input()
</code></pre>

<style>
.center {
    display: block;
    margin: 0 auto;
}
</style>

<div class="references">
<table>
<tbody>
<tr id="ref-spice">
<td>spice</td>
<td><p>Nagel L.: <i>Spice: A computer program to simulate computer circuits</i>. University of California, Berkeley UCB/ERL Memo M520. (1995)</p></td>
</tr>
<tr id="ref-mna">
<td>mna</td>
<td><p>Ho C., Ruehli A., Brennan P.: <i>The modified nodal approach to network analysis</i>. IEEE Transactions on circuits and systems. <b>22</b>, (1975)</p></td>
</tr>
<tr id="ref-orlando">
<td>orlando</td>
<td><p>Orlando T.P., Delin K.A.: <i>Foundations of applied superconductivity</i>. (1991)</p></td>
</tr>
<tr id="ref-suitesparse">
<td>suitesparse</td>
<td><p>Davis T.A.: <i>Direct methods for sparse linear systems</i>. (2006)</p></td>
</tr>
<tr id="ref-crs">
<td>crs</td>
<td _c_c="\c{c"><p>Bulu</td>
</tr>
<tr id="ref-jsim">
<td>jsim</td>
<td><p>Fang E.S.: <i>A Josephson integrated circuit simulator (JSIM) for superconductive electronics application</i>. (1989)</p></td>
</tr>
<tr id="ref-wrspice">
<td>wrspice</td>
<td><p>Simulator W.C.: <i>Whiteley Research Incorporated</i>. (2017)</p></td>
</tr>
</tbody>
</table>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href=".." title="Home" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </div>
            </div>
          </a>
        
        
          <a href="../ex_usage/" title="Example Usage" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Example Usage
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../assets/javascripts/bundle.b39636ac.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>