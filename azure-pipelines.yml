name: "Linux"

strategy:
  matrix:
    gcc8:
      Container: pleroux0/devel-gcc8:latest
    clang7-libstdc++:
      Container: pleroux0/devel-clang7:latest
      CXXFLAGS: -stdlib=libstdc++
    clang7-libc++:
      Container: pleroux0/devel-clang7:latest
      CXXFLAGS: -stdlib=libc++

trigger:
  batch: true
  branches:
    include:
    - '*'

pool:
  vmImage: 'Ubuntu-16.04'

container: $[ variables['Container'] ]

steps:
- script: mkdir -p build
  displayName: 'Make build folder'

- script: sudo apt-get -y install libsuitesparse-dev python3-dev
  displayName: 'Install APT dependencies'

- script: conan install ..
  displayName: 'Install Conan dependencies'
  workingDirectory: build

- script: cmake ..
  workingDirectory: build
  displayName: 'Configure'

- script: cmake --build .
  workingDirectory: build
  displayName: 'Build'

- script: ctest --output-on-failure
  workingDirectory: build
  displayName: 'Test'
